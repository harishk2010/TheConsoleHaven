<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> Shop
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row flex-row-reverse">
                <div class="col-lg-9">
                    <div class="shop-product-fillter">
                        <div class="totall-product">
                            <p> We found <strong class="text-brand">{{count}}</strong> items for you!</p>
                        </div>
                        <div class="sort-by-product-area">
                            <div class="sort-by-cover mr-10">
                                <div class="sort-by-product-wrap">
                                    <div class="sort-by">
                                        <span><i class="fi-rs-apps"></i>Show:</span>
                                    </div>
                                    <div class="sort-by-dropdown-wrap">
                                        <span> 50 <i class="fi-rs-angle-small-down"></i></span>
                                    </div>
                                </div>
                                <div class="sort-by-dropdown">
                                    <ul>
                                        <li><a class="active" href="#">50</a></li>
                                        <li><a href="#">100</a></li>
                                        <li><a href="#">150</a></li>
                                        <li><a href="#">200</a></li>
                                        <li><a href="#">All</a></li>
                                    </ul>
                                </div>
                            </div>
                            {{!-- <div class="sort-by-cover">
                                <div class="sort-by-product-wrap">
                                    <div class="sort-by">
                                        <span><i class="fi-rs-apps-sort"></i>Sort by:</span>
                                    </div>
                                    <div class="sort-by-dropdown-wrap">
                                        <span> Featured <i class="fi-rs-angle-small-down"></i></span>
                                    </div>
                                </div>
                                <div class="sort-by-dropdown">
                                    <ul>
                                        <li><a class="active" href="#">Featured</a></li>
                                        <li><a href="/shop_lowToHigh">Price: Low to High</a></li>
                                        <li><a href="/shop_highToLow">Price: High to Low</a></li>
                                        <li><a href="#">Release Date</a></li>
                                        <li><a href="#">Avg. Rating</a></li>
                                    </ul>
                                </div>
                            </div> --}}
                        </div>
                    </div>
                    <div class="row product-grid-3">
                        {{#each products}}
                        <div class="col-lg-4 col-md-4 col-12 col-sm-6">
                            <div class="product-cart-wrap mb-30">
                                <div class="product-img-action-wrap">
                                    <div class="product-img product-img-zoom">
                                        <a href="/productDetails/{{this._id}}">
                                            <img class="default-img" src="/images/products/{{image.[0]}}" alt="">
                                            <img class="hover-img" src="/images/products/{{image.[1]}}" alt="">
                                        </a>
                                    </div>
                                    <div class="product-action-1">
                                        <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal"
                                            data-bs-target="#quickViewModal">
                                            <i class="fi-rs-search"></i></a>
                                        <a aria-label="Add To Wishlist" class="action-btn hover-up"
                                            href="shop-wishlist.html"><i class="fi-rs-heart"></i></a>
                                        <a aria-label="Compare" class="action-btn hover-up" href="shop-compare.html"><i
                                                class="fi-rs-shuffle"></i></a>
                                    </div>
                                    <div class="product-badges product-badges-position product-badges-mrg">
                                        <span class="hot">Hot</span>
                                    </div>
                                </div>
                                <div class="product-content-wrap">
                                    <div class="product-category">
                                        <a href="shop-grid-right.html">{{this.category.category}}</a>
                                    </div>
                                    <h2><a href="shop-product-right.html">{{name}}</a></h2>
                                    <div class="rating-result" title="90%">
                                        <span>
                                            <span>90%</span>
                                        </span>
                                    </div>
                                    <div class="product-price">
                                        <span>₹{{price}}</span>
                                        <span class="old-price">₹245.8</span>
                                    </div>

                                    <div class="product-action-1 show">
                                        <a aria-label="Add To Cart" class="action-btn hover-up" href="#"><i
                                                class="fi-rs-shopping-bag-add"></i></a>
                                        {{!-- <a data-id="{{this._id}}" aria-label="Add To Cart"
                                            class="wish action-btn hover-up" href="#"><i
                                                class="material-symbols-outlined-heart"></i></a> --}}
                                        <a data-id="{{this._id}}" aria-label="Add To Wishlist"
                                            class="wish action-btn hover-up" href="#"><i class="fi-rs-heart"></i></a>
                                    </div>

                                </div>
                                {{!-- <span class="material-symbols-outlined">
                                    heart_plus
                                </span> --}}
                            </div>
                        </div>
                        {{/each}}



                    </div>
                    <!--pagination-->
                    <div class="pagination-area mt-15 mb-sm-5 mb-lg-0">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination justify-content-start">
                               {{#each pages}}
                             <li class="page-item active"><a class="page-link" href="?page={{this}}">{{this}}</a></li>
                        {{/each}}
                            </ul>
                        </nav>
                    </div>
                </div>
                <div class="col-lg-3 primary-sidebar sticky-sidebar">
                    <div class="widget-category mb-30">
                        <h5 class="section-title style-1 mb-30 wow fadeIn animated">Category</h5>
                        <ul class="categories">
                            {{#each categories}}
                            <li><a href="/filterByCategory/{{this._id}}">{{category}}</a></li>
                            {{/each}}
                            {{!-- {{#each categories}}
                            
                            <li><input type="text" hidden value="{{this._id}}" id='cat_id{{this._id}}'>
                                <a onclick="categoryFilter('{{this._id}}')">{{category}}</a></li>
                            {{/each}} --}}
                            {{!-- <li><a href="shop-grid-right.html">Blouses & Shirts</a></li>
                            <li><a href="shop-grid-right.html">Dresses</a></li>
                            <li><a href="shop-grid-right.html">Swimwear</a></li>
                            <li><a href="shop-grid-right.html">Beauty</a></li>
                            <li><a href="shop-grid-right.html">Jewelry & Watch</a></li>
                            <li><a href="shop-grid-right.html">Accessories</a></li> --}}
                        </ul>
                    </div>
                    <!-- Fillter By Price -->
                    <div class="widget-category mb-30">
                        <h5 class="section-title style-1 mb-30 wow fadeIn animated">Sort</h5>
                        <ul>
                             <li><a class="active" href="#">Featured</a></li> 
                            <li><a href="/shop_lowToHigh">Price: Low to High</a></li>
                            <li><a href="/shop_highToLow">Price: High to Low</a></li>
                            <li><a href="/shop_loadAtoZ">A - Z</a></li>
                            <li><a href="/shop_loadZtoA">Z - A</a></li>
                        </ul>
                        {{!-- <ul>
                           

                            <li><a onclick="sortProductByPrice( 'asc' )">Price: Low to High</a></li>
                            <li><a onclick="sortProductByPrice( 'desc' )">Price: High to Low</a></li>
                            <li><a onclick="sortProduct_az( 'asc' )">A - Z</a></li>
                            <li><a onclick="sortProduct_az( 'desc' )">Z - A</a></li>
                        </ul> --}}
                    </div>

                    <!-- Product sidebar Widget -->
                    <div class="sidebar-widget product-sidebar  mb-30 p-30 bg-grey border-radius-10">
                        <div class="widget-header position-relative mb-20 pb-10">
                            <h5 class="widget-title mb-10">New products</h5>
                            <div class="bt-1 border-color-1"></div>
                        </div>
                        <div class="single-post clearfix">
                            <div class="image">
                                <img src="/assets/imgs/shop/thumbnail-3.jpg" alt="#">
                            </div>
                            <div class="content pt-10">
                                <h5><a href="shop-product-detail.html">Chen Cardigan</a></h5>
                                <p class="price mb-0 mt-5">₹99.50</p>
                                <div class="product-rate">
                                    <div class="product-rating" style="width:90%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="single-post clearfix">
                            <div class="image">
                                <img src="/assets/imgs/shop/thumbnail-4.jpg" alt="#">
                            </div>
                            <div class="content pt-10">
                                <h6><a href="shop-product-detail.html">Chen Sweater</a></h6>
                                <p class="price mb-0 mt-5">₹89.50</p>
                                <div class="product-rate">
                                    <div class="product-rating" style="width:80%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="single-post clearfix">
                            <div class="image">
                                <img src="/assets/imgs/shop/thumbnail-5.jpg" alt="#">
                            </div>
                            <div class="content pt-10">
                                <h6><a href="shop-product-detail.html">Colorful Jacket</a></h6>
                                <p class="price mb-0 mt-5">₹25</p>
                                <div class="product-rate">
                                    <div class="product-rating" style="width:60%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="banner-img wow fadeIn mb-45 animated d-lg-block d-none">
                        <img src="/assets/imgs/banner/banner-11.jpg" alt="">
                        <div class="banner-text">
                            <span>Women Zone</span>
                            <h4>Save 17% on <br>Office Dress</h4>
                            <a href="shop-grid-right.html">Shop Now <i class="fi-rs-arrow-right"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{{!--
<script src="sweetalert2.all.min.js"></script> --}}
{{!--
<script src="/assets/js/vendor/sweetalert.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://common.olemiss.edu/_js/sweet-alert/sweet-alert.css"> --}}
<script>


    $(document).ready(function () {
        $('.wish.action-btn').click(function () {
           // var id = $(this).data('id');
           var $button = $(this);
        var id = $button.data('id');
            var userId = ""; // You need to set the userId here

            $.ajax({
                type: 'POST',
                url: '/addtowishlist',
                contentType: 'application/json',
                data: JSON.stringify({ id: id, userId: userId }),
                success: function (productDdata) {
                    console.log("hiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii");
                  

                    // swal("Added to wishlist", `${data.data.product.productNname}`, "success");
                    Swal.fire({
                        title: 'Success!',
                        text: 'Product Succesfully added to Wishlist!!!',
                        icon: 'success',
                        confirmButtonText: 'Cool'
                    }).then(()=> window.location.reload())
                   // location.reload();

                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        title: 'error!',
                        text: 'Product Succesfully added to Wishlist!!!',
                        icon: 'error',
                        confirmButtonText: 'Cool'
                    });
                    console.error(error);
                }
            });
        });
    });


const categoryFilter = async (id) => {

     catId = document.getElementById('cat_id'+id).value
     console.log(catId, 'am cat idddd');

    const response = await fetch(`/category_fil?id=${id}`, {
        headers: { 'Content-Type': "application/json" }
    })

    const data = await response.json()
    console.log(data);
     
    if ( data.length > 0) {
        filteredDataDisplay(data)
    } else{
          proContainer.innerHTML = `<h2 class="m-5">No product available</h2>`
    }
}

const filteredDataDisplay = (data) => {
    proContainer.innerHTML = ''
    proContainer.innerHTML = `<div class="row product-grid-3" id="productList"></div>`
    const productList  = document.getElementById('productList')

data.forEach((products) => {
    productList.innerHTML += 
    ` <div class="col-lg-4 col-md-4 col-12 col-sm-6" >

                            <div class="product-cart-wrap mb-30">
                                <div class="product-img-action-wrap">
                                    <div class="product-img product-img-zoom">
                                        <a href="/product_details/${products._id}">
                                            <img class="default-img" src="/images/products/${products.image[0]}" alt="">
                                            <img class="hover-img" src="/images/products/${products.image[1]}" alt="">
                                        </a>
                                    </div>
                                    <div class="product-action-1">
                                        <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal"
                                            data-bs-target="#quickViewModal">
                                            <i class="fi-rs-search"></i></a>
                                        <a aria-label="Add To Wishlist" class="action-btn hover-up"
                                            href="shop-wishlist.html"><i class="fi-rs-heart"></i></a>
                                        <a aria-label="Compare" class="action-btn hover-up" href="shop-compare.html"><i
                                                class="fi-rs-shuffle"></i></a>
                                    </div>
                                    <div class="product-badges product-badges-position product-badges-mrg">
                                        <span class="hot">Hot</span>
                                    </div>
                                </div>
                                <div class="product-content-wrap">
                                    <div class="product-category">
                                        <a href="shop-grid-right.html">${products.category.category}</a>
                                    </div>
                                    <h2><a href="shop-product-right.html">${products.name}</a></h2>
                                    <div class="rating-result" title="90%">
                                        <span>
                                            <span>90%</span>
                                        </span>
                                    </div>
                                    <div class="product-price">
                                        <span>₹${products.price}</span>
                                        <span class="old-price">₹245.8</span>
                                    </div>

                                    <div class="product-action-1 show">
                                        <a aria-label="Add To Cart" class="action-btn hover-up" href="#"><i
                                                class="fi-rs-shopping-bag-add"></i></a>
                                        {{!-- <a data-id="{{this._id}}" aria-label="Add To Cart"
                                            class="wish action-btn hover-up" href="#"><i
                                                class="material-symbols-outlined-heart"></i></a> --}}
                                        <a data-id="{{this._id}}" aria-label="Add To Wishlist"
                                            class="wish action-btn hover-up" href="#"><i class="fi-rs-heart"></i></a>
                                    </div>

                                </div>
                                {{!-- <span class="material-symbols-outlined">
                                    heart_plus
                                </span> --}}
                            </div>
                        </div>`
})
}


const sortProduct_az = async (sort) => {

    const response = await fetch (`/sort_product_az`, {
        method: 'POST',
        headers: {
            'Content-Type' : 'application/json'
        },
        body:JSON.stringify({
            sort: sort,
            catId: catId
        })
    }) 
    const data = await response.json()
    if ( data.length > 0) {
        filteredDataDisplay(data)
      } else{
          proContainer.innerHTML = `<h2 class="m-5">No product available</h2>`
        }
}



const sortProductByPrice = async ( sort ) => {
    console.log('am from sort product');
    const response = await fetch (`/sort_product_price`, {
        method: 'POST',
        headers: {
            'Content-Type' : 'application/json'
        },
        body:JSON.stringify({
            sort : sort,
            catId: catId
        })
    }) 
    const data = await response.json()
    if ( data.length > 0) {
        filteredDataDisplay(data)
      } else{
          proContainer.innerHTML = `<h2 class="m-5">No product available</h2>`
    }
}



</script>